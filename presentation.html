<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>Verifying Imperative Programs With Dafny</title>

	<meta name="description" content="A talk on how to use formal methods & Dafny to verify imperative programs.">
	<meta name="author" content="Bogdan Kyuchukov">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<link rel="stylesheet" href="dist/theme/night.css" id="theme">

	<link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section data-background-image="css/images/wide_fullhd_lmu-munich.jpg" data-background-opacity="0.1">
				<h4>Verifying Imperative
					Programs With Dafny</h4>
				<small>Deductive Software Verification</small>
				<br>
				<small>Bogdan Kyuchukov</small>
			</section>
			<section>
				<h4>Outline</h4>
				<small>
					<ol>
						<li class="fragment fade-up">Why Dafny?</li>
						<li class="fragment fade-up">Floyd Logic & Building Blocks of Dafny</li>
						<li class="fragment fade-up">Recursion & Termination</li>
						<li class="fragment fade-up">Inductive Datatypes</li>
						<li class="fragment fade-up">Lemmas & Proofs</li>
						<li class="fragment fade-up">Loop invariants</li>
						<li class="fragment fade-up">Arrays & Searching</li>
						<li class="fragment fade-up">Objects & Frames</li>
					</ol>
				</small>
			</section>
			<!-- ####################### Why Dafny? ####################### -->
			<section>Why Dafny?
				<section>
					<div class="fragment fade-up">
						<img src="css/images/dafny-infra.jpg" style="width: 30rem; 
					height: 15rem; 
					border-radius: 10px;" />
						<small>
							<ul>
								<li>Designed as a verification-aware programming language,
									requiring verification along with
									code development</li>
								<li style="margin-top: 1rem;">Verifier is run as part of the compiler. As such, a
									programmer
									interacts with it the
									same way as with the static type checker</li>
								<li style="margin-top: 1rem;">Verifier is powered by <a
										href="https://research.microsoft.com/boogie">Boogie</a> and
									<a href="https://github.com/z3prover">Z3</a>. The general proof framework is that of
									Hoare logic
								</li>
								<li style="margin-top: 1rem;">From verified programs, the compiler can produce code for
									a
									number of different
									backends: the .NET platform via intermediate C# files, Java, Javascript, Go, and C++
								</li>
							</ul>
						</small>
					</div>
				</section>
				<section>
					<div style="display: flex; align-items: flex-start; gap: 7rem;">
						<div style="flex: 1;">
							<small>
								<ul>
									<li>Dafny was designed by Rustan Leino at Microsoft Research after his
										previous work on
										developing ESC/Java and Spec#</li>
									<li class="fragment" data-fragment-index="2" style="margin-top: 1rem;">Author of the
										book
										<a href="https://program-proofs.com">Program Proofs</a>
									</li>
									<li class="fragment" data-fragment-index="4" style="margin-top: 1rem;">Owner of
										<a href="https://www.youtube.com/channel/UCP2eLEql4tROYmIYm5mA27A">Verification
											Corner</a> YouTube channel
									</li>
								</ul>
							</small>
						</div>
						<div style="flex: 1; display: flex; flex-direction: row;">
							<img class="fragment" data-fragment-index="1" src="css/images/rustan-leino.png" style="
					width: 10rem;
					height: 14.5rem; 
					border-radius: 10px;" />
							<img class="fragment" data-fragment-index="3" src="css/images/program-proofs-book-cover.jpg"
								style="
					margin-left: 3rem;
					width: 10rem;
					height: 14.5rem; 
					border-radius: 10px;" />
						</div>
					</div>
				</section>
				<section>
					<div class="fragment fade-in">
						<p>Because it's successfully being used in production by AWS</p>
						<iframe width="550" height="340" src="https://www.youtube.com/embed/oshxAJGrwMU"
							style="border-radius: 10px;"
							title="AWS re:Inforce 2024 - Proving the correctness of AWS authorization (IAM401)"
							allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
							referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
					</div>
				</section>
			</section>
			<!-- ####################### Floyd Logic ####################### -->
			<section>Floyd Logic
				<section data-auto-animate>
					<pre>
						<code data-id="floyd-decoration" data-line-numbers>
							method Triple(x: int) returns (r: int) 
							  requires 0 <= x
							  ensures r == 3 * x {
								var y;
								y := 2 * x;
								r := x + y;
							}
						</code>
					</pre>
				</section>
				<section data-auto-animate>
					<pre>
						<code data-id="floyd-decoration" data-line-numbers="11-12|10|9-10|8|7-8|6|5">
							method Triple(x: int) returns (r: int)
							  requires 0 <= x
							  ensures r == 3 * x {
								[ 0 <= x ==> 3 * x == x + 2 * x ]
								[ forall y :: 3 * x == x + 2 * x ]
								var y;
								[ x + 2 * x == 3 * x ]
								y := 2 * x;
								[ x + y == 3 * x ]
								r := x + y;
								[ r == 3 * x ]
							}
						</code>
					</pre>
				</section>
				<section>
					<pre><code class="language-javascript">var t := Triple(u + 3);</code></pre>
					<pre class="fragment fade-in">
						<code class="language-html" data-trim>
							var x’, r’;
							x’ := u + 3;
							assert 0 <= x'
							assume r’ == 3 * x';
							t := r’;
						</code>
					</pre>
					<pre class="fragment fade-in"><code>Q[t := 3 * (u + 3)]</code></pre>
					<pre class="fragment fade-in">
						<code data-trim>
							[ u == 15 ] t := Triple(u + 3) [t == 54]
						</code>
					</pre>
				</section>
			</section>
			<!-- ####################### Building Blocks of Dafny ####################### -->
			<section>Building Blocks of Dafny
				<pre>
					<code class="language-javascript" data-trim data-line-numbers="1-4|6-10|12-14|16-20|22-26">
						function Average(a: int, b: int): int
						  requires 0 <= a && 0 <= b {
							(a + b) / 2
						}

						method Triple’(x: int) returns (r: int)
						  ensures Average(r, 3 * x) == 3 * x {
							var y := 2 * x;
							r := x + y;
						}
						
						predicate IsEven(x: int) {
							x % 2 == 0
						}

						method IllegalAssignment() returns (y: int) {
							ghost var x := 10;
							y := 2 * x; // error: cannot assign to compiled
							// variable using a ghost
						}

						ghost method DoubleQuadruple(x: int) 
						returns (a: int, b: int)
						  ensures a == 2 * x && b == 4 * x {
							a := 2 * x;
							b := 2 * a;
						}
					</code>
				</pre>
			</section>
			<section>Recursion & Termination
				<section>
					<small>
						<ul>
							<li class="fragment" data-fragment-index="1" style="margin-top: 1rem;"><em>Partial
									correctness</em>: every terminating call is correct,
								but
								not all calls do indeed terminate</li>
							<li class="fragment" data-fragment-index="3" style="margin-top: 1rem;"><em>Total
									correctness</em>:
								partially correct and always
								terminates
							</li>
							<li class="fragment" data-fragment-index="5" style="margin-top: 1rem;"><em>Termination
									metric</em>: activation record callee < activation record caller </li>
						</ul>
					</small>
					<pre class="fragment fade-in" class="fragment" data-fragment-index="2">
						<code data-trim data-line-numbers class="language-javascript" data-trim>
							method PartialId(x: int) returns (y: int)
								ensures y == x {
								if x % 2 == 0 {
									y := x;
								} else {
									y := PartialId(x); // error: failure to prove termination
								}
							}
						</code>
					</pre>
					<pre class="fragment" data-fragment-index="4" class="fragment fade-in">
						<code data-trim data-line-numbers class="language-html" data-trim>
							function Fib(n: nat): nat {
								if n < 2 then n else Fib(n - 2) + Fib(n - 1)
							}
						</code>
					</pre>
				</section>
				<section style="text-align: left;">
					<small>A binary relation is well-founded if the following
						three conditions hold:
						<ul>
							<li style="margin-top: 1rem;">is <em>irreflexive</em>: the relation never relates an element
								to itself</li>
							<li style="margin-top: 1rem;">is <em>transitive</em>: whenever a ≻ b and b ≻ c hold, then so
								does a ≻ c, for any a, b, and c
							</li>
							<li style="margin: 1rem 0 1rem 0;">the relation has no <em>infinite descending chain</em>
							</li>
						</ul>
						Here are the built-in well-founded relations for some of Dafny’s types:
					</small>
					<img src="css/images/dafny-types-decreases.png" style="
					width: 50rem;
					height: 14.5rem; 
					border-radius: 10px;" />
				</section>
			</section>

			<script src="dist/reveal.js"></script>
			<script src="plugin/zoom/zoom.js"></script>
			<script src="plugin/notes/notes.js"></script>
			<script src="plugin/search/search.js"></script>
			<script src="plugin/markdown/markdown.js"></script>
			<script src="plugin/highlight/highlight.js"></script>
			<script>

				// Also available as an ES module, see:
				// https://revealjs.com/initialization/
				Reveal.initialize({
					controls: false,
					progress: true,
					center: true,
					hash: true,
					slideNumber: true,
					autoAnimate: true,

					// Learn about plugins: https://revealjs.com/plugins/
					plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight]
				});

			</script>

</body>

</html>